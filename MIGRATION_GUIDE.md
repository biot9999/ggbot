# Fragment API è¿ç§»æŒ‡å—

## ğŸ“Œ æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°å°† Fragment ä¼šå‘˜å¼€é€šåŠŸèƒ½ä» **Playwright æµè§ˆå™¨è‡ªåŠ¨åŒ–** è¿ç§»åˆ° **Telethon + Fragment API** çº¯ API æ–¹å¼ã€‚

## ğŸ¯ ä¸ºä»€ä¹ˆè¦è¿ç§»ï¼Ÿ

### æ—§æ–¹æ¡ˆï¼ˆPlaywrightï¼‰çš„é—®é¢˜ï¼š
- âŒ éœ€è¦å®‰è£… Chromium æµè§ˆå™¨ï¼ˆ~300MBï¼‰
- âŒ éœ€è¦ç³»ç»Ÿä¾èµ–åº“ï¼ˆnssã€cupsã€gtk3 ç­‰ï¼‰
- âŒ èµ„æºå ç”¨å¤§ï¼ˆæµè§ˆå™¨è¿›ç¨‹ï¼‰
- âŒ ä¸ç¨³å®šï¼ˆé¡µé¢æ›´æ–°ä¼šå¯¼è‡´é€‰æ‹©å™¨å¤±æ•ˆï¼‰
- âŒ é€Ÿåº¦æ…¢

### æ–°æ–¹æ¡ˆï¼ˆTelethon + APIï¼‰çš„ä¼˜åŠ¿ï¼š
- âœ… çº¯ API è°ƒç”¨ï¼Œæ— éœ€æµè§ˆå™¨
- âœ… æ— ç³»ç»Ÿä¾èµ–ï¼Œåªéœ€ Python åŒ…
- âœ… é€Ÿåº¦å¿«ï¼Œèµ„æºå ç”¨å°‘
- âœ… ç¨³å®šå¯é ï¼Œä¸å—é¡µé¢å˜åŒ–å½±å“
- âœ… é¦–æ¬¡ç™»å½•åè‡ªåŠ¨ä¿å­˜ session

## ğŸ”„ ä¸»è¦å˜åŒ–

### 1. ä¾èµ–å˜åŒ–

**åˆ é™¤ï¼š**
```
playwright==1.40.0
```

**æ·»åŠ ï¼š**
```
telethon==1.36.0
```

### 2. é…ç½®å˜åŒ–

**æ–°å¢é…ç½®é¡¹ï¼ˆ.envï¼‰ï¼š**
```env
# Telegram API é…ç½®ï¼ˆç”¨äº Fragment è®¤è¯ï¼‰
TELEGRAM_API_ID=2040
TELEGRAM_API_HASH=b18441a1ff607e10a989891a5462e627
TELEGRAM_PHONE=+ä½ çš„æ‰‹æœºå·ï¼ˆå›½é™…æ ¼å¼ï¼Œå¦‚ +8613800138000ï¼‰
```

> **é‡è¦ï¼š** `TELEGRAM_PHONE` å¿…é¡»é…ç½®ï¼Œæ ¼å¼ä¸ºå›½é™…æ ¼å¼ï¼ˆåŒ…å«å›½å®¶ä»£ç ï¼‰

### 3. å®‰è£…æ­¥éª¤å˜åŒ–

**ä¹‹å‰ï¼š**
```bash
pip install -r requirements.txt
playwright install chromium  # éœ€è¦è¿™ä¸€æ­¥
python main.py
```

**ç°åœ¨ï¼š**
```bash
pip install -r requirements.txt  # åªéœ€è¿™ä¸€æ­¥
python main.py
```

### 4. ç™»å½•æµç¨‹å˜åŒ–

**ä¹‹å‰ï¼š**
- éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šæ‰“å¼€æµè§ˆå™¨
- æ‰«æ QR ç æˆ–ä½¿ç”¨æ‰‹æœºå·ç™»å½•
- 3 åˆ†é’Ÿè¶…æ—¶

**ç°åœ¨ï¼š**
- çº¯å‘½ä»¤è¡Œæ“ä½œ
- é¦–æ¬¡ç™»å½•è¾“å…¥ Telegram éªŒè¯ç 
- Session è‡ªåŠ¨ä¿å­˜
- åç»­æ— éœ€éªŒè¯ç 

## ğŸ“‹ è¿ç§»æ­¥éª¤

### 1. æ‹‰å–æœ€æ–°ä»£ç 

```bash
cd ggbot
git pull origin main
```

### 2. æ›´æ–°ä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. æ›´æ–°é…ç½®

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œæ·»åŠ ï¼š

```env
# æ·»åŠ è¿™ä¸‰è¡Œ
TELEGRAM_API_ID=2040
TELEGRAM_API_HASH=b18441a1ff607e10a989891a5462e627
TELEGRAM_PHONE=+8613800138000  # æ›¿æ¢ä¸ºä½ çš„æ‰‹æœºå·
```

### 4. åˆ é™¤æ—§çš„ Session æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

```bash
rm fragment_session.json  # æ—§çš„æµè§ˆå™¨ session
# æ–°çš„ session æ–‡ä»¶åä¸º fragment_session.session
```

### 5. é‡å¯æœºå™¨äºº

```bash
# å¦‚æœä½¿ç”¨ systemd
sudo systemctl restart telegram-premium-bot

# æˆ–ç›´æ¥è¿è¡Œ
python main.py
```

### 6. é‡æ–°ç™»å½•

1. å‘æœºå™¨äººå‘é€ `/login`
2. è¾“å…¥ä» Telegram æ”¶åˆ°çš„éªŒè¯ç 
3. ç™»å½•æˆåŠŸï¼Œsession è‡ªåŠ¨ä¿å­˜

## ğŸ” éªŒè¯è¿ç§»

### æ£€æŸ¥ä¾èµ–

```bash
python3 << 'EOF'
try:
    from telethon import TelegramClient
    print("âœ… Telethon å·²å®‰è£…")
except:
    print("âŒ Telethon æœªå®‰è£…")

try:
    from playwright.async_api import async_playwright
    print("âš ï¸  Playwright ä»ç„¶å­˜åœ¨ï¼ˆå¯ä»¥å¸è½½ï¼‰")
except:
    print("âœ… Playwright å·²ç§»é™¤")
EOF
```

### æµ‹è¯•ç™»å½•

```bash
# å‘æœºå™¨äººå‘é€
/login

# åº”è¯¥çœ‹åˆ°æ–°çš„æç¤ºä¿¡æ¯ï¼š
# "ä½¿ç”¨ Telethon + Fragment API æ–¹å¼ç™»å½•"
```

### æµ‹è¯•ä½™é¢æŸ¥è¯¢

```bash
# å‘æœºå™¨äººå‘é€
/balance

# åº”è¯¥èƒ½æ­£å¸¸è¿”å›ä½™é¢
```

## â“ å¸¸è§é—®é¢˜

### Q1: æç¤º "æœªé…ç½® Telegram æ‰‹æœºå·"

**A:** ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œè®¾ç½® `TELEGRAM_PHONE=+ä½ çš„æ‰‹æœºå·`

### Q2: éªŒè¯ç åœ¨å“ªé‡Œæ¥æ”¶ï¼Ÿ

**A:** éªŒè¯ç ä¼šå‘é€åˆ°ä½ é…ç½®çš„æ‰‹æœºå·çš„ Telegram è´¦å·ä¸­

### Q3: éœ€è¦å¸è½½ Playwright å—ï¼Ÿ

**A:** å¯ä»¥å¸è½½ä»¥èŠ‚çœç©ºé—´ï¼š
```bash
pip uninstall playwright
```

### Q4: Session æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ

**A:** æ–°çš„ session æ–‡ä»¶åä¸º `fragment_session.session`ï¼ˆTelethon æ ¼å¼ï¼‰

### Q5: æ˜¯å¦å½±å“ç°æœ‰è®¢å•ï¼Ÿ

**A:** ä¸å½±å“ã€‚åªæ˜¯æ”¹å˜äº† Fragment äº¤äº’æ–¹å¼ï¼Œè®¢å•æ•°æ®å®Œå…¨å…¼å®¹ã€‚

### Q6: API_ID å’Œ API_HASH æ˜¯ä»€ä¹ˆï¼Ÿ

**A:** è¿™æ˜¯ Telegram å®˜æ–¹çš„å…¬å…± API å‡­è¯ï¼Œç”¨äº Telethon è¿æ¥ Telegramã€‚é»˜è®¤å€¼å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

### Q7: éœ€è¦é‡æ–°é…ç½® Fragment è´¦å·å—ï¼Ÿ

**A:** éœ€è¦é‡æ–°ç™»å½•ä¸€æ¬¡ï¼ˆä½¿ç”¨ `/login` å‘½ä»¤ï¼‰ï¼Œä¹‹åä¼šè‡ªåŠ¨ä¿å­˜ sessionã€‚

## ğŸ†˜ æ•…éšœæ’é™¤

### é”™è¯¯: "No module named 'telethon'"

```bash
pip install telethon==1.36.0
```

### é”™è¯¯: "TELEGRAM_PHONE not configured"

ç¼–è¾‘ `.env`ï¼Œæ·»åŠ ï¼š
```env
TELEGRAM_PHONE=+ä½ çš„æ‰‹æœºå·
```

### é”™è¯¯: "ç™»å½•å¤±è´¥"

1. æ£€æŸ¥æ‰‹æœºå·æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆéœ€è¦ + å’Œå›½å®¶ä»£ç ï¼‰
2. ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
3. æŸ¥çœ‹æ—¥å¿—ï¼š`journalctl -u telegram-premium-bot -n 50`

### ç™»å½•åæç¤º "Fragment not initialized"

1. é‡å¯æœºå™¨äºº
2. é‡æ–°æ‰§è¡Œ `/login`
3. æ£€æŸ¥æ—¥å¿—æŸ¥çœ‹è¯¦ç»†é”™è¯¯

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | Playwright | Telethon + API |
|------|-----------|----------------|
| å®‰è£…å¤§å° | ~350MB | ~5MB |
| å†…å­˜å ç”¨ | ~200MB | ~50MB |
| å¯åŠ¨æ—¶é—´ | ~10s | ~1s |
| ç™»å½•æ—¶é—´ | 2-3åˆ†é’Ÿ | 10-30ç§’ |
| ç¨³å®šæ€§ | ä¸­ç­‰ | é«˜ |

## ğŸ‰ å‡çº§å®Œæˆ

å‡çº§å®Œæˆåï¼Œä½ åº”è¯¥ï¼š
- âœ… æ— éœ€æµè§ˆå™¨ä¾èµ–
- âœ… æ›´å¿«çš„å“åº”é€Ÿåº¦
- âœ… æ›´å°‘çš„èµ„æºå ç”¨
- âœ… æ›´ç¨³å®šçš„æœåŠ¡

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
2. æ£€æŸ¥é…ç½®æ–‡ä»¶
3. åœ¨ GitHub æäº¤ Issue

---

**æœ€åæ›´æ–°ï¼š** 2025-12-15
